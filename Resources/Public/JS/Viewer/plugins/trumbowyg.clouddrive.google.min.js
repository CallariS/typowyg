// @ts-nocheck
var gAPI_Initialized,gIS_Initialized,tokenClient;jQuery.trumbowyg.XC.CloudStorage.Browser.currentRoot=["root"];var initializeGAPI=()=>{window.WaXCode.CORE.checkPathByString(window,"WaXCode.Interact.script")||(window.WaXCode.CORE.createPathByString(window,"WaXCode.Interact"),window.WaXCode.Interact.script=document.createElement("script"),window.WaXCode.Interact.script.src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js",document.head.appendChild(window.WaXCode.Interact.script)),window.WaXCode.CORE.checkPathByString(window,"WaXCode.gAPI")||(window.WaXCode.CORE.createPathByString(window,"WaXCode.gAPI"),window.WaXCode.gAPI=document.createElement("script"),window.WaXCode.gAPI.src="https://apis.google.com/js/api.js",window.WaXCode.gAPI.onload=()=>{console.log("gAPI Loaded.");try{var e=jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.o.plugins.WaXCode_OnlineStorage_Google.clientID}catch(e){throw console.error('Google / Drive - API Key not available (is the "Google / Drive (cx_editor)" - TypoScript included in your template?). Unable to initialize Google Drive. Internal: '),e}gapi.load("client",(async()=>{await gapi.client.init({apiKey:e,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}),gAPI_Initialized=!0}))},document.head.appendChild(window.WaXCode.gAPI)),window.WaXCode.CORE.checkPathByString(window,"WaXCode.gIS")||(window.WaXCode.CORE.createPathByString(window,"WaXCode.gIS"),window.WaXCode.gIS=document.createElement("script"),window.WaXCode.gIS.src="https://accounts.google.com/gsi/client",window.WaXCode.gIS.onload=()=>{console.log("gIS Loaded.");try{jQuery.trumbowyg.XC.CloudStorage.Browser.Loader=WaXCode.NET.syncGET(jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.o.plugins.WaXCode_OnlineStorage_Google.cDriveLoaderHTML),jQuery.trumbowyg.XC.CloudStorage.Browser.icoLinkFile=jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.o.plugins.WaXCode_OnlineStorage_Google.cDriveLinkIcon,jQuery.trumbowyg.XC.CloudStorage.Browser.icoEmbedFile=jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.o.plugins.WaXCode_OnlineStorage_Google.cDriveEmbedIcon,jQuery.trumbowyg.XC.CloudStorage.Browser.icoCreateDirectory=jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.o.plugins.WaXCode_OnlineStorage_Google.cDriveDirectoryIcon,jQuery.trumbowyg.XC.CloudStorage.Browser.icoRename=jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.o.plugins.WaXCode_OnlineStorage_Google.cDriveRenameIcon,jQuery.trumbowyg.XC.CloudStorage.Browser.icoUpload=jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.o.plugins.WaXCode_OnlineStorage_Google.cDriveUploadIcon;var e=jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.o.plugins.WaXCode_OnlineStorage_Google.clientID,o=jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.o.plugins.WaXCode_OnlineStorage_Google.scopes}catch(e){throw console.error('Google / Drive - Client ID not available (is the "Google / Drive (cx_editor)" - TypoScript included in your template?). Unable to initialize Google Drive. Internal: '+e.message),e}tokenClient=google.accounts.oauth2.initTokenClient({client_id:e,scope:o,callback:""}),gIS_Initialized=!0},document.head.appendChild(window.WaXCode.gIS))},getShareableLink=async(e,o)=>{gapi.client.drive.files.get({fileId:e,fields:o?"webContentLink":"webViewLink"}).then((r=>{window.WaXCode_CX_Editor_GoogleDrive_ModalOpened=!1,o?gapi.client.drive.permissions.create({fileId:e,resource:{role:"reader",type:"anyone"}}).then((o=>{let t;null==r.result.webContentLink&&gapi.client.drive.files.get({fileId:e,fields:"webViewLink"}).then((e=>{jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.execCmd("insertHTML",`\n                            <a  href    = '${e.result.webViewLink}'\n                                target  = 'blank'\n                                class   = '-XC_OS_GD --Link'>${""!=jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.getRangeText()?jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.getRangeText():jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.lang.webContentUnavailable}</a>`)})),jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.execCmd("insertHTML",`\n                    <iframe id      = "${t=WaXCode.CORE.generateRandomId({options:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"})}"\n                            src     = "${r.result.webContentLink.replace("&export=download","").replace("https://drive.google.com/uc?id=","https://drive.google.com/file/d/")+"/preview"}"\n                            class   = '-XC_OS_GD --Embedded'></iframe>`),interact("#"+t).resizable({edges:{left:!0,right:!0,bottom:!0,top:!0},listeners:{move(e){var o=e.target,r=parseFloat(o.getAttribute("data-x"))||0,t=parseFloat(o.getAttribute("data-y"))||0;o.setAttribute("style","width : "+e.rect.width+"px ; height : "+e.rect.height+"px ; translate( "+e.deltaRect.left+"px, "+e.deltaRect.top+"px );"),o.setAttribute("data-x",r),o.setAttribute("data-y",t),o.textContent=Math.round(e.rect.width)+"×"+Math.round(e.rect.height)}}})})):jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.execCmd("insertHTML",`\n            <a  href    = "${r.result.webViewLink}"\n                target  = "blank" >${""!=jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.getRangeText()?jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.getRangeText():jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.lang.link}</a>`),jQuery.trumbowyg.XC.CloudStorage.Browser.opened=!1,jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.closeModal()}))},updateFilelist=async e=>{let o;try{o=await gapi.client.drive.files.list({q:"'"+e+"' in parents",fields:"files( id, name, mimeType )",orderBy:"name"})}catch(e){throw console.log(jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.lang.unableToRetrieveFiles.replaceAll("[%ERROR%]",e.message)),e}jQuery.trumbowyg.XC.CloudStorage.Browser.files=o.result.files};let cmdRename=async(e,o)=>gapi.client.drive.files.update({fileId:e,name:o}),cmdCreate=(e,o,r)=>gapi.client.drive.files.create({resource:{name:e,mimeType:o,parents:[r]}}),cmdUpload=async e=>new Promise(((o,r)=>{let t=new FileReader;t.onload=async t=>{let a=new FormData;a.append("metadata",new Blob([JSON.stringify({name:e.name,mimeType:e.type,parents:[jQuery.trumbowyg.XC.CloudStorage.Browser.currentRoot[jQuery.trumbowyg.XC.CloudStorage.Browser.currentRoot.length-1]]})],{type:"application/json"})),a.append("file",new Blob([new Uint8Array(t.target.result)],{type:e.type}));try{await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:new Headers({Authorization:"Bearer "+gapi.auth.getToken().access_token}),body:a})}catch(e){r(e)}o()},t.readAsArrayBuffer(e)}));!function(e){"use strict";e.extend(!0,e.trumbowyg,{langs:{it:{WaXCode_OnlineStorage_Google:"Collegare/Incorporare Contenuti da Google Drive"},en:{WaXCode_OnlineStorage_Google:"Link/Embed Content From Google Drive"},az:{WaXCode_OnlineStorage_Google:"Google Disk-dən Məzmunu Bağlamaq/Yerləşdirmək"},by:{WaXCode_OnlineStorage_Google:"Падключыць/Убудаваць змесціва з Google Drive"},da:{WaXCode_OnlineStorage_Google:"Google Drive"},de:{WaXCode_OnlineStorage_Google:"Inhalte auf Google Drive verlinken / einbetten"},et:{WaXCode_OnlineStorage_Google:"Google Drive"},fr:{WaXCode_OnlineStorage_Google:"Lier/Intégrer du contenu depuis Google Drive"},hu:{WaXCode_OnlineStorage_Google:"Google Drive"},ko:{WaXCode_OnlineStorage_Google:"Google Drive"},pt_br:{WaXCode_OnlineStorage_Google:"Google Drive"},ru:{WaXCode_OnlineStorage_Google:"Ссылка/Встраивание контента из Google Drive"},sl:{WaXCode_OnlineStorage_Google:"Prepojiť/Vložiť obsah z Google Drive"},tr:{WaXCode_OnlineStorage_Google:"Google Drive"},zh_tw:{WaXCode_OnlineStorage_Google:"點擊這裡開啟檔案"}},plugins:{myplugin:{init:o=>{console.log(o),jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg=o,initializeGAPI(),jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.o.plugins.myplugin=e.extend(!0,{},{},jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.o.plugins.myplugin||{});const r=e(document.createElementNS("http://www.w3.org/2000/svg","svg"));r.addClass("trumbowyg-icons"),r.html("\n                        <symbol id = 'trumbowyg-waxcode_cx_editor_google_drive' viewBox = '0 0 87.3 78'>\n                            <path d = 'm6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z'                 fill = '#0066da'/>\n                            <path d = 'm43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44a9.06 9.06 0 0 0 -1.2 4.5h27.5z'                fill = '#00ac47'/>\n                            <path d = 'm73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z' fill = '#ea4335'/>\n                            <path d = 'm43.65 25 13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2z'                         fill = '#00832d'/>\n                            <path d = 'm59.8 53h-32.3l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z'                      fill = '#2684fc'/>\n                            <path d = 'm73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3l-13.75 23.8 16.15 28h27.45c0-1.55-.4-3.1-1.2-4.5z'       fill = '#ffba00'/></symbol>").appendTo(document.body),jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.addBtnDef("WaXCode_OnlineStorage_Google",{ico:"waxcode_cx_editor_google_drive",fn:()=>{null==jQuery.trumbowyg.XC.CloudStorage.Browser.files&&(null!=gAPI_Initialized&&null!=gIS_Initialized||alert(jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.lang.loadingGAPI),gAPI_Initialized&&gIS_Initialized||alert(jQuery.trumbowyg.XC.CloudStorage.Browser.refTrumbowyg.lang.GAPI_NA),tokenClient.callback=async e=>{if(void 0!==e.error)throw e;jQuery.trumbowyg.XC.CloudStorage.Browser.showDriveBrowser("root",updateFilelist,"application/vnd.google-apps.folder",cmdRename,getShareableLink,cmdCreate,cmdUpload),jQuery.trumbowyg.XC.CloudStorage.Browser.opened=!0},null===gapi.client.getToken()?tokenClient.requestAccessToken({prompt:"consent"}):tokenClient.requestAccessToken({prompt:""})),jQuery.trumbowyg.XC.CloudStorage.Browser.opened||jQuery.trumbowyg.XC.CloudStorage.Browser.showDriveBrowser(jQuery.trumbowyg.XC.CloudStorage.Browser.currentRoot[jQuery.trumbowyg.XC.CloudStorage.Browser.currentRoot.length-1],updateFilelist,"application/vnd.google-apps.folder",cmdRename,getShareableLink,cmdCreate,cmdUpload)}})},tagHandler:(e,o)=>[],destroy:e=>{}}}})}(jQuery);